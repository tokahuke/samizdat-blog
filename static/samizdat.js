(()=>{"use strict";var t=function(t,e,n,r){return new(n||(n=Promise))((function(s,i){function o(t){try{c(r.next(t))}catch(t){i(t)}}function u(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,u)}c((r=r.apply(t,e||[])).next())}))},e=function(t,e){var n,r,s,i,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(s=2&i[0]?r.return:i[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,i[1])).done)return s;switch(r=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((s=(s=o.trys).length>0&&s[s.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){o.label=i[1];break}if(6===i[0]&&o.label<s[1]){o.label=s[1],s=i;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(i);break}s[2]&&o.ops.pop(),o.trys.pop();continue}i=e.call(t,o)}catch(t){i=[6,t],r=0}finally{n=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}};function n(n,r,s){return t(this,void 0,void 0,(function(){return e(this,(function(t){switch(t.label){case 0:return[4,fetch("http://localhost:4510"+r,{method:n,headers:{"Content-Type":"application/json"},body:s?JSON.stringify(s):void 0})];case 1:return[2,t.sent()]}}))}))}function r(n,r,s){return t(this,void 0,void 0,(function(){return e(this,(function(t){switch(t.label){case 0:return[4,fetch("http://localhost:4510"+r,{method:n,body:s})];case 1:return[2,t.sent()]}}))}))}var s=function(t,e,n,r){return new(n||(n=Promise))((function(s,i){function o(t){try{c(r.next(t))}catch(t){i(t)}}function u(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,u)}c((r=r.apply(t,e||[])).next())}))},i=function(t,e){var n,r,s,i,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(s=2&i[0]?r.return:i[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,i[1])).done)return s;switch(r=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((s=(s=o.trys).length>0&&s[s.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){o.label=i[1];break}if(6===i[0]&&o.label<s[1]){o.label=s[1],s=i;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(i);break}s[2]&&o.ops.pop(),o.trys.pop();continue}i=e.call(t,o)}catch(t){i=[6,t],r=0}finally{n=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}};function o(t){return s(this,void 0,void 0,(function(){var e,n,r,s,o;return i(this,(function(i){switch(i.label){case 0:return[4,fetch("/_auth/_current")];case 1:return 200!=(e=i.sent()).status?[3,3]:[4,e.json()];case 2:for(n=i.sent().Ok,r=0,s=t;r<s.length;r++)if(o=s[r],!n.includes(o))return[2,!1];return[2,!0];case 3:return[2,!1]}}))}))}function u(t){return s(this,void 0,void 0,(function(){var e,n,r,s,o,u,c;return i(this,(function(i){switch(i.label){case 0:if(e=window.screen,n={width:e.width/4,height:2*e.height/3},r=n.width,s=n.height,o=t.map((function(t){return"right="+t})).join("&"),!(u=window.open("/_register?"+o,"RegisterApp","\n      left="+(e.width-r)/2+",\n      top="+(e.height-s)/4+",\n      width="+r+",\n      height="+s+"\n    ")))throw new Error("Could not open authentication window");return[4,new Promise((function(t){u.addEventListener("auth",(function(e){return t(e)}))}))];case 1:switch(c=i.sent(),console.log(c),c.detail.status){case"canceled":throw new Error("User canceled authentication flow");case"fail":throw new Error("Authentication flow failed");case"success":return[2]}return[2]}}))}))}function c(t){return s(this,void 0,void 0,(function(){return i(this,(function(e){switch(e.label){case 0:return[4,o(t)];case 1:return e.sent()?[3,3]:[4,u(t)];case 2:e.sent(),e.label=3;case 3:return[2]}}))}))}var a,l,h=function(t,e,n,r){return new(n||(n=Promise))((function(s,i){function o(t){try{c(r.next(t))}catch(t){i(t)}}function u(t){try{c(r.throw(t))}catch(t){i(t)}}function c(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,u)}c((r=r.apply(t,e||[])).next())}))},f=function(t,e){var n,r,s,i,o={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return i={next:u(0),throw:u(1),return:u(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function u(i){return function(u){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(s=2&i[0]?r.return:i[0]?r.throw||((s=r.return)&&s.call(r),0):r.next)&&!(s=s.call(r,i[1])).done)return s;switch(r=0,s&&(i=[2&i[0],s.value]),i[0]){case 0:case 1:s=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!((s=(s=o.trys).length>0&&s[s.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!s||i[1]>s[0]&&i[1]<s[3])){o.label=i[1];break}if(6===i[0]&&o.label<s[1]){o.label=s[1],s=i;break}if(s&&o.label<s[2]){o.label=s[2],o.ops.push(i);break}s[2]&&o.ops.pop(),o.trys.pop();continue}i=e.call(t,o)}catch(t){i=[6,t],r=0}finally{n=s=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,u])}}};!function(t){t.ManageObjects="ManageObjects",t.GetObjectStats="GetObjectStats",t.ManageBookmarks="ManageBookmarks",t.ManageCollections="ManageCollections",t.ManageSeries="ManageSeries",t.ManageSubscriptions="ManageSubscriptions"}(a||(a={})),function(t){t.FullInventory="FullInventory"}(l||(l={}));var p=function(){function t(t){this.accessRights=null!=t?t:[],this.isAuthenticated=!1,this.kvstore=new d}return t.prototype.authenticate=function(){return h(this,void 0,void 0,(function(){return f(this,(function(t){switch(t.label){case 0:return this.isAuthenticated?[3,2]:[4,c(this.accessRights)];case 1:t.sent(),this.isAuthenticated=!0,t.label=2;case 2:return[2]}}))}))},t.prototype._ensureRights=function(t){return h(this,void 0,void 0,(function(){var e,n,r;return f(this,(function(s){switch(s.label){case 0:e=0,n=this.accessRights,s.label=1;case 1:return e<n.length?(r=n[e],t.includes(r)?[4,this.authenticate()]:[3,3]):[3,4];case 2:return s.sent(),[2];case 3:return e++,[3,1];case 4:throw new Error("Current scope needs any of "+t+" but only has "+this.accessRights)}}))}))},t.prototype.getObject=function(t){return h(this,void 0,void 0,(function(){return f(this,(function(e){switch(e.label){case 0:return[4,n("GET","/_objects/"+t)];case 1:return[4,e.sent().blob()];case 2:return[2,e.sent()]}}))}))},t.prototype.postObject=function(t){return h(this,void 0,void 0,(function(){return f(this,(function(e){switch(e.label){case 0:return[4,this._ensureRights([a.ManageObjects])];case 1:return e.sent(),[4,r("POST","/_objects",t)];case 2:return[4,e.sent().text()];case 3:return[2,e.sent()]}}))}))},t.prototype.deleteObject=function(t){return h(this,void 0,void 0,(function(){return f(this,(function(e){switch(e.label){case 0:return[4,this._ensureRights([a.ManageObjects])];case 1:return e.sent(),[4,n("DELETE","/_objects/"+t)];case 2:return[2,e.sent().status<300]}}))}))},t.prototype.reissue=function(t){return h(this,void 0,void 0,(function(){return f(this,(function(e){switch(e.label){case 0:return[4,this._ensureRights([a.ManageObjects])];case 1:return e.sent(),[4,n("POST","/_objects/"+t+"/reissue")];case 2:return[4,e.sent().text()];case 3:return[2,e.sent()]}}))}))},t.prototype.bookmark=function(t){return h(this,void 0,void 0,(function(){return f(this,(function(e){switch(e.label){case 0:return[4,this._ensureRights([a.ManageBookmarks])];case 1:return e.sent(),[4,n("POST","/_objects/"+t+"/bookmark")];case 2:return[4,e.sent().json()];case 3:return[2,e.sent().Ok]}}))}))},t.prototype.isBookmarked=function(t){return h(this,void 0,void 0,(function(){return f(this,(function(e){switch(e.label){case 0:return[4,this._ensureRights([a.ManageBookmarks])];case 1:return e.sent(),[4,n("GET","/_objects/"+t+"/bookmark")];case 2:return[4,e.sent().json()];case 3:return[2,e.sent().Ok]}}))}))},t.prototype.unbookmark=function(t){return h(this,void 0,void 0,(function(){return f(this,(function(e){switch(e.label){case 0:return[4,this._ensureRights([a.ManageBookmarks])];case 1:return e.sent(),[4,n("DELETE","/_objects/"+t+"/bookmark")];case 2:return[4,e.sent().json()];case 3:return[2,e.sent().Ok]}}))}))},t.prototype.getObjectStats=function(t){return h(this,void 0,void 0,(function(){return f(this,(function(e){switch(e.label){case 0:return[4,this._ensureRights([a.GetObjectStats])];case 1:return e.sent(),[4,n("GET","/_objects/"+t+"/stats")];case 2:return[4,e.sent().json()];case 3:return[2,e.sent().Ok]}}))}))},t.prototype.getByteUsefulness=function(t){return h(this,void 0,void 0,(function(){return f(this,(function(e){switch(e.label){case 0:return[4,this._ensureRights([a.GetObjectStats])];case 1:return e.sent(),[4,n("GET","/_objects/"+t+"/stats/byte-usefulness")];case 2:return[4,e.sent().json()];case 3:return[2,e.sent().Ok]}}))}))},t.prototype.postCollection=function(t,e){return void 0===e&&(e=!1),h(this,void 0,void 0,(function(){return f(this,(function(r){switch(r.label){case 0:return[4,this._ensureRights([a.ManageCollections])];case 1:return r.sent(),[4,n("POST","/_collections",{hashes:t,is_draft:e})];case 2:return[4,r.sent().text()];case 3:return[2,r.sent()]}}))}))},t.prototype.getItem=function(t,e){return h(this,void 0,void 0,(function(){return f(this,(function(r){switch(r.label){case 0:return[4,n("GET","/_collections"+t+e)];case 1:return[4,r.sent().blob()];case 2:return[2,r.sent()]}}))}))},t.prototype.postSeriesOwner=function(t,e,r){return void 0===e&&(e=null),void 0===r&&(r=!1),h(this,void 0,void 0,(function(){return f(this,(function(s){switch(s.label){case 0:return[4,this._ensureRights([a.ManageSeries])];case 1:return s.sent(),[4,n("POST","/_seriesowners",{series_owner_name:t,keypair:e,is_draft:r})];case 2:return[4,s.sent().json()];case 3:return[2,s.sent().Ok]}}))}))},t.prototype.getSeriesOwner=function(t){return h(this,void 0,void 0,(function(){return f(this,(function(e){switch(e.label){case 0:return[4,this._ensureRights([a.ManageSeries])];case 1:return e.sent(),[4,n("GET","/_seriesowners/"+t)];case 2:return[4,e.sent().json()];case 3:return[2,e.sent().Ok]}}))}))},t.prototype.deleteSeriesOwner=function(t){return h(this,void 0,void 0,(function(){return f(this,(function(e){switch(e.label){case 0:return[4,this._ensureRights([a.ManageSeries])];case 1:return e.sent(),[4,n("DELETE","/_seriesowners/"+t)];case 2:return[4,e.sent().json()];case 3:return[2,e.sent().Ok]}}))}))},t.prototype.getSeriesOwners=function(){return h(this,void 0,void 0,(function(){return f(this,(function(t){switch(t.label){case 0:return[4,this._ensureRights([a.ManageSeries])];case 1:return t.sent(),[4,n("GET","/_seriesowners")];case 2:return[4,t.sent().json()];case 3:return[2,t.sent().Ok]}}))}))},t.prototype.postEdition=function(t,e,r,s){return void 0===r&&(r=null),void 0===s&&(s=!1),h(this,void 0,void 0,(function(){return f(this,(function(i){switch(i.label){case 0:return[4,this._ensureRights([a.ManageSeries])];case 1:return i.sent(),[4,n("POST","/_seriesowner/"+t+"/editions",{collection:e,ttl:r,no_announce:s})];case 2:return[4,i.sent().json()];case 3:return[2,i.sent().Ok]}}))}))},t.prototype.getSeriesItem=function(t,e){return h(this,void 0,void 0,(function(){return f(this,(function(r){switch(r.label){case 0:return[4,n("GET","/_series"+t+e)];case 1:return[4,r.sent().blob()];case 2:return[2,r.sent()]}}))}))},t.prototype.getIdentityItem=function(t,e){return h(this,void 0,void 0,(function(){return f(this,(function(r){switch(r.label){case 0:if(t.startsWith("_")||""==t.toString())throw new Error('Invalid identity handle "'+t+'"');return[4,n("GET","/"+t+e)];case 1:return[4,r.sent().blob()];case 2:return[2,r.sent()]}}))}))},t.prototype.getSubscription=function(t){return h(this,void 0,void 0,(function(){return f(this,(function(e){switch(e.label){case 0:return[4,this._ensureRights([a.ManageSubscriptions])];case 1:return e.sent(),[4,n("GET","/_subscriptions"+t)];case 2:return[4,e.sent().json()];case 3:return[2,e.sent().Ok]}}))}))},t.prototype.postSubscription=function(t,e){return void 0===e&&(e=l.FullInventory),h(this,void 0,void 0,(function(){return f(this,(function(r){switch(r.label){case 0:return[4,this._ensureRights([a.ManageSubscriptions])];case 1:return r.sent(),[4,n("POST","/_subscriptions",{series_key:t,kind:e})];case 2:return[4,r.sent().json()];case 3:return[2,r.sent().Ok]}}))}))},t.prototype.deleteSubscription=function(t){return h(this,void 0,void 0,(function(){return f(this,(function(e){switch(e.label){case 0:return[4,this._ensureRights([a.ManageSubscriptions])];case 1:return e.sent(),[4,n("DELETE","/_subscriptions"+t)];case 2:return[4,e.sent().json()];case 3:return[2,e.sent().Ok]}}))}))},t}(),d=function(){function t(){}return t.prototype.get=function(t){return h(this,void 0,void 0,(function(){return f(this,(function(e){switch(e.label){case 0:return[4,n("GET","/_kvstore/"+t)];case 1:return[4,e.sent().json()];case 2:return[2,e.sent().Ok]}}))}))},t.prototype.put=function(t,e){return h(this,void 0,void 0,(function(){return f(this,(function(r){switch(r.label){case 0:return[4,n("PUT","/_kvstore/"+t,{value:e})];case 1:return[4,r.sent().json()];case 2:return[2,r.sent().Ok]}}))}))},t.prototype.delete=function(t){return h(this,void 0,void 0,(function(){return f(this,(function(e){switch(e.label){case 0:return[4,n("DELETE","/_kvstore/"+t)];case 1:return[4,e.sent().json()];case 2:return[2,e.sent().Ok]}}))}))},t.prototype.clear=function(){return h(this,void 0,void 0,(function(){return f(this,(function(t){switch(t.label){case 0:return[4,n("DELETE","/_kvstore")];case 1:return[4,t.sent().json()];case 2:return[2,t.sent().Ok]}}))}))},t}();window.Samizdat=p})();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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WUFBQW1GLElBQU4sU0FBVUQsRUFBYUUsRywwRkFDSixTQUFNbkcsRUFBSyxNQUFPLGFBQWFpRyxFQUFPLENBQUVFLE1BQUssSyxPQUN0RCxTQURTLFNBQ01wRixRLE9BQXZCLE1BQU8sQ0FBUCxFQUFRLFNBQTJCLFlBRy9CLFlBQUFxRixPQUFOLFNBQWFILEcsMEZBQ00sU0FBTWpHLEVBQUssU0FBVSxhQUFhaUcsSSxPQUMzQyxTQURTLFNBQ01sRixRLE9BQXZCLE1BQU8sQ0FBUCxFQUFRLFNBQTJCLFlBRy9CLFlBQUFzRixNQUFOLFcsMEZBQ21CLFNBQU1yRyxFQUFLLFNBQVUsYyxPQUM5QixTQURTLFNBQ01lLFEsT0FBdkIsTUFBTyxDQUFQLEVBQVEsU0FBMkIsWUFFdkMsRUF0QkEsR0E4QkFNLE9BQU9pRixTQUFXQSxHIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc2FtaXpkYXRqcy8uL3NyYy9hcGkudHMiLCJ3ZWJwYWNrOi8vc2FtaXpkYXRqcy8uL3NyYy9hdXRoLnRzIiwid2VicGFjazovL3NhbWl6ZGF0anMvLi9zcmMvaW5kZXgudHMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGFzeW5jIGZ1bmN0aW9uIGNhbGwobWV0aG9kOiBzdHJpbmcsIHJvdXRlOiBzdHJpbmcsIHBheWxvYWQ/OiBPYmplY3QpIHtcbiAgcmV0dXJuIGF3YWl0IGZldGNoKGBodHRwOi8vbG9jYWxob3N0OjQ1MTAke3JvdXRlfWAsIHtcbiAgICBtZXRob2QsXG4gICAgaGVhZGVyczoge1xuICAgICAgXCJDb250ZW50LVR5cGVcIjogXCJhcHBsaWNhdGlvbi9qc29uXCIsXG4gICAgfSxcbiAgICBib2R5OiBwYXlsb2FkID8gSlNPTi5zdHJpbmdpZnkocGF5bG9hZCkgOiB1bmRlZmluZWQsXG4gIH0pO1xufVxuXG5leHBvcnQgYXN5bmMgZnVuY3Rpb24gY2FsbFJhdyhtZXRob2Q6IHN0cmluZywgcm91dGU6IHN0cmluZywgYm9keTogQm9keUluaXQpIHtcbiAgcmV0dXJuIGF3YWl0IGZldGNoKGBodHRwOi8vbG9jYWxob3N0OjQ1MTAke3JvdXRlfWAsIHtcbiAgICBtZXRob2QsXG4gICAgYm9keSxcbiAgfSk7XG59XG4iLCJpbXBvcnQgeyBBY2Nlc3NSaWdodCB9IGZyb20gXCIuL2luZGV4XCI7XG5cbmFzeW5jIGZ1bmN0aW9uIGlzQXV0aGVudGljYXRlZChhY2Nlc3NSaWdodHM6IEFycmF5PEFjY2Vzc1JpZ2h0Pikge1xuICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGZldGNoKFwiL19hdXRoL19jdXJyZW50XCIpO1xuXG4gIGlmIChyZXNwb25zZS5zdGF0dXMgPT0gMjAwKSB7XG4gICAgY29uc3QgZ3JhbnRlZFJpZ2h0czogQXJyYXk8QWNjZXNzUmlnaHQ+ID0gKGF3YWl0IHJlc3BvbnNlLmpzb24oKSlbXCJPa1wiXTtcbiAgICBmb3IgKGNvbnN0IHJpZ2h0IG9mIGFjY2Vzc1JpZ2h0cykge1xuICAgICAgaWYgKCFncmFudGVkUmlnaHRzLmluY2x1ZGVzKHJpZ2h0KSkge1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgICB9XG4gICAgfVxuXG4gICAgcmV0dXJuIHRydWU7XG4gIH1cblxuICByZXR1cm4gZmFsc2U7XG59XG5cbmFzeW5jIGZ1bmN0aW9uIGRvQXV0aGVudGljYXRpb25GbG93KGFjY2Vzc1JpZ2h0czogQXJyYXk8QWNjZXNzUmlnaHQ+KSB7XG4gIGludGVyZmFjZSBBdXRoZW50aWNhdGlvbkRldGFpbCB7XG4gICAgc3RhdHVzOiBcInN1Y2Nlc3NcIiB8IFwiZmFpbFwiIHwgXCJjYW5jZWxlZFwiO1xuICAgIHN0YXR1c0NvZGU6IG51bWJlcixcbiAgfVxuXG4gIGNvbnN0IHNjcmVlbiA9IHdpbmRvdy5zY3JlZW47XG4gIGNvbnN0IHsgd2lkdGgsIGhlaWdodCB9ID0ge1xuICAgIHdpZHRoOiBzY3JlZW4ud2lkdGggLyA0LjAsXG4gICAgaGVpZ2h0OiAoc2NyZWVuLmhlaWdodCAqIDIuMCkgLyAzLjAsXG4gIH07XG4gIGNvbnN0IHF1ZXJ5ID0gYWNjZXNzUmlnaHRzLm1hcChyaWdodCA9PiBgcmlnaHQ9JHtyaWdodH1gKS5qb2luKFwiJlwiKTtcbiAgY29uc3QgYXV0aFdpbmRvdyA9IHdpbmRvdy5vcGVuKFxuICAgIGAvX3JlZ2lzdGVyPyR7cXVlcnl9YCxcbiAgICBcIlJlZ2lzdGVyQXBwXCIsXG4gICAgYFxuICAgICAgbGVmdD0keyhzY3JlZW4ud2lkdGggLSB3aWR0aCkgLyAyLjB9LFxuICAgICAgdG9wPSR7KHNjcmVlbi5oZWlnaHQgLSBoZWlnaHQpIC8gNC4wfSxcbiAgICAgIHdpZHRoPSR7d2lkdGh9LFxuICAgICAgaGVpZ2h0PSR7aGVpZ2h0fVxuICAgIGBcbiAgKTtcblxuICBpZiAoIWF1dGhXaW5kb3cpIHtcbiAgICB0aHJvdyBuZXcgRXJyb3IoXCJDb3VsZCBub3Qgb3BlbiBhdXRoZW50aWNhdGlvbiB3aW5kb3dcIik7XG4gIH1cblxuICBjb25zdCBldmVudCA9IGF3YWl0IG5ldyBQcm9taXNlPEN1c3RvbUV2ZW50PEF1dGhlbnRpY2F0aW9uRGV0YWlsPj4oXG4gICAgKHJlc29sdmVyKSA9PiB7XG4gICAgICBhdXRoV2luZG93LmFkZEV2ZW50TGlzdGVuZXIoXG4gICAgICAgIFwiYXV0aFwiLFxuICAgICAgICAoZTogQ3VzdG9tRXZlbnQ8QXV0aGVudGljYXRpb25EZXRhaWw+KSA9PiByZXNvbHZlcihlKVxuICAgICAgKTtcbiAgICB9XG4gICk7XG5cbiAgY29uc29sZS5sb2coZXZlbnQpO1xuXG4gIHN3aXRjaCAoZXZlbnQuZGV0YWlsLnN0YXR1cykge1xuICAgIGNhc2UgXCJjYW5jZWxlZFwiOlxuICAgICAgdGhyb3cgbmV3IEVycm9yKFwiVXNlciBjYW5jZWxlZCBhdXRoZW50aWNhdGlvbiBmbG93XCIpO1xuICAgIGNhc2UgXCJmYWlsXCI6XG4gICAgICB0aHJvdyBuZXcgRXJyb3IoXCJBdXRoZW50aWNhdGlvbiBmbG93IGZhaWxlZFwiKTtcbiAgICBjYXNlIFwic3VjY2Vzc1wiOlxuICAgICAgcmV0dXJuO1xuICB9XG59XG5cbmV4cG9ydCBhc3luYyBmdW5jdGlvbiBhdXRoZW50aWNhdGUoYWNjZXNzUmlnaHRzOiBBcnJheTxBY2Nlc3NSaWdodD4pIHtcbiAgaWYgKCEoYXdhaXQgaXNBdXRoZW50aWNhdGVkKGFjY2Vzc1JpZ2h0cykpKSB7XG4gICAgYXdhaXQgZG9BdXRoZW50aWNhdGlvbkZsb3coYWNjZXNzUmlnaHRzKTtcbiAgfVxufVxuIiwiaW1wb3J0IHsgY2FsbCwgY2FsbFJhdyB9IGZyb20gXCIuL2FwaVwiO1xuaW1wb3J0IHsgYXV0aGVudGljYXRlIH0gZnJvbSBcIi4vYXV0aFwiO1xuXG5leHBvcnQgZW51bSBBY2Nlc3NSaWdodCB7XG4gIE1hbmFnZU9iamVjdHMgPSBcIk1hbmFnZU9iamVjdHNcIixcbiAgR2V0T2JqZWN0U3RhdHMgPSBcIkdldE9iamVjdFN0YXRzXCIsXG4gIE1hbmFnZUJvb2ttYXJrcyA9IFwiTWFuYWdlQm9va21hcmtzXCIsXG4gIE1hbmFnZUNvbGxlY3Rpb25zID0gXCJNYW5hZ2VDb2xsZWN0aW9uc1wiLFxuICBNYW5hZ2VTZXJpZXMgPSBcIk1hbmFnZVNlcmllc1wiLFxuICBNYW5hZ2VTdWJzY3JpcHRpb25zID0gXCJNYW5hZ2VTdWJzY3JpcHRpb25zXCIsXG59XG5cbi8qKlxuICogT3V0cHV0IGZyb20gQVBJLiBUaGVyZWZvcmUsIHNuYWtlX2Nhc2UuXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgT2JqZWN0U3RhdHMge1xuICBzaXplOiBudW1iZXI7XG4gIGNyZWF0ZWRfYXQ6IHN0cmluZztcbiAgbGFzdF90b3VjaGVkX2F0OiBzdHJpbmc7XG4gIHRvdWNoZXM6IG51bWJlcjtcbn1cblxuLyoqXG4gKiBPdXRwdXQgZnJvbSBBUEkuIFRoZXJlZm9yZSwgc25ha2VfY2FzZS5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBLZXlwYWlyIHtcbiAgcHVibGljOiBBcnJheTxudW1iZXI+O1xuICBzZWNyZXQ6IEFycmF5PG51bWJlcj47XG59XG5cbi8qKlxuICogT3V0cHV0IGZyb20gQVBJLiBUaGVyZWZvcmUsIHNuYWtlX2Nhc2UuXG4gKi9cbmV4cG9ydCBpbnRlcmZhY2UgU2VyaWVzT3duZXIge1xuICBuYW1lOiBzdHJpbmc7XG4gIGtleXBhaXI6IEtleXBhaXI7XG4gIGRlZmF1bHRfdHRsOiBzdHJpbmc7XG4gIGlzX2RyYWZ0OiBib29sZWFuO1xufVxuXG4vKipcbiAqIE91dHB1dCBmcm9tIEFQSS4gVGhlcmVmb3JlLCBzbmFrZV9jYXNlLlxuICovXG5leHBvcnQgaW50ZXJmYWNlIFNpZ25lZDxUPiB7XG4gIGNvbnRlbnQ6IFQ7XG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgRWRpdGlvbkNvbnRlbnQge1xuICBjb2xsZWN0aW9uOiBzdHJpbmc7XG4gIHRpbWVzdGFtcDogc3RyaW5nO1xuICB0dGw6IHN0cmluZztcbn1cblxuLyoqXG4gKiBPdXRwdXQgZnJvbSBBUEkuIFRoZXJlZm9yZSwgc25ha2VfY2FzZS5cbiAqL1xuZXhwb3J0IGludGVyZmFjZSBFZGl0aW9uIHtcbiAgc2lnbmVkOiBTaWduZWQ8RWRpdGlvbkNvbnRlbnQ+O1xuICBwdWJsaWNfa2V5OiBzdHJpbmc7XG4gIGlzX2RyYWZ0OiBib29sZWFuO1xufVxuXG5leHBvcnQgZW51bSBTdWJzY3JpcHRpb25LaW5kIHtcbiAgRnVsbEludmVudG9yeSA9IFwiRnVsbEludmVudG9yeVwiXG59XG5cbmV4cG9ydCBpbnRlcmZhY2UgU3Vic2NyaXB0aW9uIHtcbiAgcHVibGljX2tleTogQXJyYXk8bnVtYmVyPixcbiAga2luZDogU3Vic2NyaXB0aW9uS2luZCwgXG59XG5cbmV4cG9ydCBjbGFzcyBTYW1pemRhdCB7XG4gIGFjY2Vzc1JpZ2h0czogQXJyYXk8QWNjZXNzUmlnaHQ+O1xuICBpc0F1dGhlbnRpY2F0ZWQ6IGJvb2xlYW47XG4gIGt2c3RvcmU6IEtWU3RvcmU7XG5cbiAgY29uc3RydWN0b3IoYWNjZXNzUmlnaHRzPzogQXJyYXk8QWNjZXNzUmlnaHQ+KSB7XG4gICAgdGhpcy5hY2Nlc3NSaWdodHMgPSBhY2Nlc3NSaWdodHMgPz8gW107XG4gICAgdGhpcy5pc0F1dGhlbnRpY2F0ZWQgPSBmYWxzZTtcbiAgICB0aGlzLmt2c3RvcmUgPSBuZXcgS1ZTdG9yZSgpO1xuICB9XG5cbiAgLyoqXG4gICAqIEV4cGxpY2l0bHkgYXV0aGVudGljYXRlcyB0aGlzIGNvbnRleHQgdG8gdGhlIGN1cnJlbnQgU2FtaXpkYXQgbm9kZS5cbiAgICogQXV0aGVudGljYXRpb24gaXMgZG9uZSBhdXRvbWF0aWNhbGx5IHdoZW4gdXNpbmcgdGhpcyBvYmplY3QuXG4gICAqL1xuICBhc3luYyBhdXRoZW50aWNhdGUoKSB7XG4gICAgaWYgKCF0aGlzLmlzQXV0aGVudGljYXRlZCkge1xuICAgICAgYXdhaXQgYXV0aGVudGljYXRlKHRoaXMuYWNjZXNzUmlnaHRzKTtcbiAgICAgIHRoaXMuaXNBdXRoZW50aWNhdGVkID0gdHJ1ZTtcbiAgICB9XG4gIH1cblxuICBhc3luYyBfZW5zdXJlUmlnaHRzKG5lY2Vzc2FyeVJpZ2h0czogQXJyYXk8QWNjZXNzUmlnaHQ+KSB7XG4gICAgZm9yIChjb25zdCByaWdodCBvZiB0aGlzLmFjY2Vzc1JpZ2h0cykge1xuICAgICAgaWYgKG5lY2Vzc2FyeVJpZ2h0cy5pbmNsdWRlcyhyaWdodCkpIHtcbiAgICAgICAgYXdhaXQgdGhpcy5hdXRoZW50aWNhdGUoKTtcbiAgICAgICAgcmV0dXJuO1xuICAgICAgfVxuICAgIH1cblxuICAgIHRocm93IG5ldyBFcnJvcihcbiAgICAgIGBDdXJyZW50IHNjb3BlIG5lZWRzIGFueSBvZiAke25lY2Vzc2FyeVJpZ2h0c30gYnV0IG9ubHkgaGFzICR7dGhpcy5hY2Nlc3NSaWdodHN9YFxuICAgICk7XG4gIH1cblxuICBhc3luYyBnZXRPYmplY3Qob2JqZWN0OiBzdHJpbmcpIHtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGNhbGwoXCJHRVRcIiwgYC9fb2JqZWN0cy8ke29iamVjdH1gKTtcbiAgICByZXR1cm4gYXdhaXQgcmVzcG9uc2UuYmxvYigpO1xuICB9XG5cbiAgYXN5bmMgcG9zdE9iamVjdChjb250ZW50OiBCbG9iKSB7XG4gICAgYXdhaXQgdGhpcy5fZW5zdXJlUmlnaHRzKFtBY2Nlc3NSaWdodC5NYW5hZ2VPYmplY3RzXSk7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBjYWxsUmF3KFwiUE9TVFwiLCBgL19vYmplY3RzYCwgY29udGVudCk7XG4gICAgcmV0dXJuIGF3YWl0IHJlc3BvbnNlLnRleHQoKTtcbiAgfVxuXG4gIGFzeW5jIGRlbGV0ZU9iamVjdChvYmplY3Q6IHN0cmluZykge1xuICAgIGF3YWl0IHRoaXMuX2Vuc3VyZVJpZ2h0cyhbQWNjZXNzUmlnaHQuTWFuYWdlT2JqZWN0c10pO1xuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgY2FsbChcIkRFTEVURVwiLCBgL19vYmplY3RzLyR7b2JqZWN0fWApO1xuICAgIHJldHVybiByZXNwb25zZS5zdGF0dXMgPCAzMDA7XG4gIH1cblxuICBhc3luYyByZWlzc3VlKG9iamVjdDogc3RyaW5nKSB7XG4gICAgYXdhaXQgdGhpcy5fZW5zdXJlUmlnaHRzKFtBY2Nlc3NSaWdodC5NYW5hZ2VPYmplY3RzXSk7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBjYWxsKFwiUE9TVFwiLCBgL19vYmplY3RzLyR7b2JqZWN0fS9yZWlzc3VlYCk7XG4gICAgcmV0dXJuIGF3YWl0IHJlc3BvbnNlLnRleHQoKTtcbiAgfVxuXG4gIGFzeW5jIGJvb2ttYXJrKG9iamVjdDogc3RyaW5nKSB7XG4gICAgYXdhaXQgdGhpcy5fZW5zdXJlUmlnaHRzKFtBY2Nlc3NSaWdodC5NYW5hZ2VCb29rbWFya3NdKTtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGNhbGwoXCJQT1NUXCIsIGAvX29iamVjdHMvJHtvYmplY3R9L2Jvb2ttYXJrYCk7XG4gICAgcmV0dXJuIChhd2FpdCByZXNwb25zZS5qc29uKCkpW1wiT2tcIl0gYXMgbnVsbDtcbiAgfVxuXG4gIGFzeW5jIGlzQm9va21hcmtlZChvYmplY3Q6IHN0cmluZykge1xuICAgIGF3YWl0IHRoaXMuX2Vuc3VyZVJpZ2h0cyhbQWNjZXNzUmlnaHQuTWFuYWdlQm9va21hcmtzXSk7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBjYWxsKFwiR0VUXCIsIGAvX29iamVjdHMvJHtvYmplY3R9L2Jvb2ttYXJrYCk7XG4gICAgcmV0dXJuIChhd2FpdCByZXNwb25zZS5qc29uKCkpW1wiT2tcIl0gYXMgYm9vbGVhbjtcbiAgfVxuXG4gIGFzeW5jIHVuYm9va21hcmsob2JqZWN0OiBzdHJpbmcpIHtcbiAgICBhd2FpdCB0aGlzLl9lbnN1cmVSaWdodHMoW0FjY2Vzc1JpZ2h0Lk1hbmFnZUJvb2ttYXJrc10pO1xuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgY2FsbChcIkRFTEVURVwiLCBgL19vYmplY3RzLyR7b2JqZWN0fS9ib29rbWFya2ApO1xuICAgIHJldHVybiAoYXdhaXQgcmVzcG9uc2UuanNvbigpKVtcIk9rXCJdIGFzIG51bGw7XG4gIH1cblxuICBhc3luYyBnZXRPYmplY3RTdGF0cyhvYmplY3Q6IHN0cmluZykge1xuICAgIGF3YWl0IHRoaXMuX2Vuc3VyZVJpZ2h0cyhbQWNjZXNzUmlnaHQuR2V0T2JqZWN0U3RhdHNdKTtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGNhbGwoXCJHRVRcIiwgYC9fb2JqZWN0cy8ke29iamVjdH0vc3RhdHNgKTtcbiAgICByZXR1cm4gKGF3YWl0IHJlc3BvbnNlLmpzb24oKSlbXCJPa1wiXSBhcyBvYmplY3Q7XG4gIH1cblxuICBhc3luYyBnZXRCeXRlVXNlZnVsbmVzcyhvYmplY3Q6IHN0cmluZykge1xuICAgIGF3YWl0IHRoaXMuX2Vuc3VyZVJpZ2h0cyhbQWNjZXNzUmlnaHQuR2V0T2JqZWN0U3RhdHNdKTtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGNhbGwoXG4gICAgICBcIkdFVFwiLFxuICAgICAgYC9fb2JqZWN0cy8ke29iamVjdH0vc3RhdHMvYnl0ZS11c2VmdWxuZXNzYFxuICAgICk7XG4gICAgcmV0dXJuIChhd2FpdCByZXNwb25zZS5qc29uKCkpW1wiT2tcIl0gYXMgbnVtYmVyIHwgbnVsbDtcbiAgfVxuXG4gIGFzeW5jIHBvc3RDb2xsZWN0aW9uKFxuICAgIGhhc2hlczogQXJyYXk8W3N0cmluZywgc3RyaW5nXT4sXG4gICAgaXNEcmFmdDogYm9vbGVhbiA9IGZhbHNlXG4gICkge1xuICAgIGF3YWl0IHRoaXMuX2Vuc3VyZVJpZ2h0cyhbQWNjZXNzUmlnaHQuTWFuYWdlQ29sbGVjdGlvbnNdKTtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGNhbGwoXCJQT1NUXCIsIGAvX2NvbGxlY3Rpb25zYCwge1xuICAgICAgaGFzaGVzLFxuICAgICAgaXNfZHJhZnQ6IGlzRHJhZnQsXG4gICAgfSk7XG4gICAgcmV0dXJuIGF3YWl0IHJlc3BvbnNlLnRleHQoKTtcbiAgfVxuXG4gIGFzeW5jIGdldEl0ZW0oY29sbGVjdGlvbjogc3RyaW5nLCBwYXRoOiBzdHJpbmcpIHtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGNhbGwoXCJHRVRcIiwgYC9fY29sbGVjdGlvbnMke2NvbGxlY3Rpb259JHtwYXRofWApO1xuICAgIHJldHVybiBhd2FpdCByZXNwb25zZS5ibG9iKCk7XG4gIH1cblxuICBhc3luYyBwb3N0U2VyaWVzT3duZXIoc2VyaWVzT3duZXJOYW1lOiBzdHJpbmcsIGtleXBhaXIgPSBudWxsLCBpc0RyYWZ0ID0gZmFsc2UpIHtcbiAgICBhd2FpdCB0aGlzLl9lbnN1cmVSaWdodHMoW0FjY2Vzc1JpZ2h0Lk1hbmFnZVNlcmllc10pO1xuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgY2FsbChcIlBPU1RcIiwgYC9fc2VyaWVzb3duZXJzYCwge1xuICAgICAgc2VyaWVzX293bmVyX25hbWU6IHNlcmllc093bmVyTmFtZSxcbiAgICAgIGtleXBhaXIsXG4gICAgICBpc19kcmFmdDogaXNEcmFmdFxuICAgIH0pO1xuICAgIHJldHVybiAoYXdhaXQgcmVzcG9uc2UuanNvbigpKVtcIk9rXCJdIGFzIG9iamVjdDtcbiAgfVxuXG4gIGFzeW5jIGdldFNlcmllc093bmVyKHNlcmllc093bmVyOiBzdHJpbmcpIHtcbiAgICBhd2FpdCB0aGlzLl9lbnN1cmVSaWdodHMoW0FjY2Vzc1JpZ2h0Lk1hbmFnZVNlcmllc10pO1xuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgY2FsbChcIkdFVFwiLCBgL19zZXJpZXNvd25lcnMvJHtzZXJpZXNPd25lcn1gKTtcbiAgICByZXR1cm4gKGF3YWl0IHJlc3BvbnNlLmpzb24oKSlbXCJPa1wiXSBhcyBTZXJpZXNPd25lciB8IG51bGw7XG4gIH1cblxuICBhc3luYyBkZWxldGVTZXJpZXNPd25lcihzZXJpZXNPd25lcjogc3RyaW5nKSB7XG4gICAgYXdhaXQgdGhpcy5fZW5zdXJlUmlnaHRzKFtBY2Nlc3NSaWdodC5NYW5hZ2VTZXJpZXNdKTtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGNhbGwoXCJERUxFVEVcIiwgYC9fc2VyaWVzb3duZXJzLyR7c2VyaWVzT3duZXJ9YCk7XG4gICAgcmV0dXJuIChhd2FpdCByZXNwb25zZS5qc29uKCkpW1wiT2tcIl0gYXMgYm9vbGVhbjtcbiAgfVxuXG4gIGFzeW5jIGdldFNlcmllc093bmVycygpIHtcbiAgICBhd2FpdCB0aGlzLl9lbnN1cmVSaWdodHMoW0FjY2Vzc1JpZ2h0Lk1hbmFnZVNlcmllc10pO1xuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgY2FsbChcIkdFVFwiLCBgL19zZXJpZXNvd25lcnNgKTtcbiAgICByZXR1cm4gKGF3YWl0IHJlc3BvbnNlLmpzb24oKSlbXCJPa1wiXSBhcyBBcnJheTxTZXJpZXNPd25lcj47XG4gIH1cblxuICBhc3luYyBwb3N0RWRpdGlvbihcbiAgICBzZXJpZXNPd25lcjogc3RyaW5nLFxuICAgIGNvbGxlY3Rpb246IHN0cmluZyxcbiAgICB0dGw6IHN0cmluZyB8IG51bGwgPSBudWxsLFxuICAgIG5vQW5ub3VuY2U6IGJvb2xlYW4gPSBmYWxzZVxuICApIHtcbiAgICBhd2FpdCB0aGlzLl9lbnN1cmVSaWdodHMoW0FjY2Vzc1JpZ2h0Lk1hbmFnZVNlcmllc10pO1xuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgY2FsbChcbiAgICAgIFwiUE9TVFwiLFxuICAgICAgYC9fc2VyaWVzb3duZXIvJHtzZXJpZXNPd25lcn0vZWRpdGlvbnNgLFxuICAgICAge1xuICAgICAgICBjb2xsZWN0aW9uLFxuICAgICAgICB0dGwsXG4gICAgICAgIG5vX2Fubm91bmNlOiBub0Fubm91bmNlLFxuICAgICAgfVxuICAgICk7XG4gICAgcmV0dXJuIChhd2FpdCByZXNwb25zZS5qc29uKCkpW1wiT2tcIl0gYXMgQXJyYXk8U2VyaWVzT3duZXI+O1xuICB9XG5cbiAgYXN5bmMgZ2V0U2VyaWVzSXRlbShzZXJpZXNLZXk6IHN0cmluZywgcGF0aDogc3RyaW5nKSB7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBjYWxsKFwiR0VUXCIsIGAvX3NlcmllcyR7c2VyaWVzS2V5fSR7cGF0aH1gKTtcbiAgICByZXR1cm4gYXdhaXQgcmVzcG9uc2UuYmxvYigpO1xuICB9XG5cbiAgYXN5bmMgZ2V0SWRlbnRpdHlJdGVtKGlkZW50aXR5SGFuZGxlOiBzdHJpbmcsIHBhdGg6IHN0cmluZykge1xuICAgIC8vIFRPRE86IG1ha2UgaXQgY29uZm9ybSBleGFjdGx5IHdpdGggSWRlbnRpdHlSZWY6OnBhcnNlLlxuICAgIGlmIChpZGVudGl0eUhhbmRsZS5zdGFydHNXaXRoKFwiX1wiKSB8fCBpZGVudGl0eUhhbmRsZS50b1N0cmluZygpID09IFwiXCIpIHtcbiAgICAgIHRocm93IG5ldyBFcnJvcihgSW52YWxpZCBpZGVudGl0eSBoYW5kbGUgXCIke2lkZW50aXR5SGFuZGxlfVwiYCk7XG4gICAgfVxuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgY2FsbChcIkdFVFwiLCBgLyR7aWRlbnRpdHlIYW5kbGV9JHtwYXRofWApO1xuICAgIHJldHVybiBhd2FpdCByZXNwb25zZS5ibG9iKCk7XG4gIH1cblxuICBhc3luYyBnZXRTdWJzY3JpcHRpb24oc2VyaWVzS2V5OiBzdHJpbmcpIHtcbiAgICBhd2FpdCB0aGlzLl9lbnN1cmVSaWdodHMoW0FjY2Vzc1JpZ2h0Lk1hbmFnZVN1YnNjcmlwdGlvbnNdKTtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGNhbGwoXCJHRVRcIiwgYC9fc3Vic2NyaXB0aW9ucyR7c2VyaWVzS2V5fWApO1xuICAgIHJldHVybiAoYXdhaXQgcmVzcG9uc2UuanNvbigpKVtcIk9rXCJdIGFzIFN1YnNjcmlwdGlvbiB8IG51bGw7XG4gIH1cblxuICBhc3luYyBwb3N0U3Vic2NyaXB0aW9uKHNlcmllc0tleTogc3RyaW5nLCBraW5kOiBTdWJzY3JpcHRpb25LaW5kID0gU3Vic2NyaXB0aW9uS2luZC5GdWxsSW52ZW50b3J5KSB7XG4gICAgYXdhaXQgdGhpcy5fZW5zdXJlUmlnaHRzKFtBY2Nlc3NSaWdodC5NYW5hZ2VTdWJzY3JpcHRpb25zXSk7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBjYWxsKFwiUE9TVFwiLCBgL19zdWJzY3JpcHRpb25zYCwgeyBzZXJpZXNfa2V5OiBzZXJpZXNLZXksIGtpbmQgfSk7XG4gICAgcmV0dXJuIChhd2FpdCByZXNwb25zZS5qc29uKCkpW1wiT2tcIl0gYXMgc3RyaW5nO1xuICB9XG5cbiAgYXN5bmMgZGVsZXRlU3Vic2NyaXB0aW9uKHNlcmllc0tleTogc3RyaW5nKSB7XG4gICAgYXdhaXQgdGhpcy5fZW5zdXJlUmlnaHRzKFtBY2Nlc3NSaWdodC5NYW5hZ2VTdWJzY3JpcHRpb25zXSk7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBjYWxsKFwiREVMRVRFXCIsIGAvX3N1YnNjcmlwdGlvbnMke3Nlcmllc0tleX1gKTtcbiAgICByZXR1cm4gKGF3YWl0IHJlc3BvbnNlLmpzb24oKSlbXCJPa1wiXSBhcyBudWxsO1xuICB9XG59XG5cbmV4cG9ydCBjbGFzcyBLVlN0b3JlIHtcbiAgY29uc3RydWN0b3IoKSB7fVxuXG4gIGFzeW5jIGdldChrZXk6IHN0cmluZykge1xuICAgIGNvbnN0IHJlc3BvbnNlID0gYXdhaXQgY2FsbChcIkdFVFwiLCBgL19rdnN0b3JlLyR7a2V5fWApO1xuICAgIHJldHVybiAoYXdhaXQgcmVzcG9uc2UuanNvbigpKVtcIk9rXCJdIGFzIHN0cmluZyB8IG51bGw7XG4gIH1cblxuICBhc3luYyBwdXQoa2V5OiBzdHJpbmcsIHZhbHVlOiBzdHJpbmcpIHtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGNhbGwoXCJQVVRcIiwgYC9fa3ZzdG9yZS8ke2tleX1gLCB7IHZhbHVlIH0pO1xuICAgIHJldHVybiAoYXdhaXQgcmVzcG9uc2UuanNvbigpKVtcIk9rXCJdIGFzIG51bGw7XG4gIH1cblxuICBhc3luYyBkZWxldGUoa2V5OiBzdHJpbmcpIHtcbiAgICBjb25zdCByZXNwb25zZSA9IGF3YWl0IGNhbGwoXCJERUxFVEVcIiwgYC9fa3ZzdG9yZS8ke2tleX1gKTtcbiAgICByZXR1cm4gKGF3YWl0IHJlc3BvbnNlLmpzb24oKSlbXCJPa1wiXSBhcyBudWxsO1xuICB9XG5cbiAgYXN5bmMgY2xlYXIoKSB7XG4gICAgY29uc3QgcmVzcG9uc2UgPSBhd2FpdCBjYWxsKFwiREVMRVRFXCIsIGAvX2t2c3RvcmVgKTtcbiAgICByZXR1cm4gKGF3YWl0IHJlc3BvbnNlLmpzb24oKSlbXCJPa1wiXSBhcyBudWxsO1xuICB9XG59XG5cbmRlY2xhcmUgZ2xvYmFsIHtcbiAgaW50ZXJmYWNlIFdpbmRvdyB7XG4gICAgU2FtaXpkYXQ6IGFueTtcbiAgfVxufVxuXG53aW5kb3cuU2FtaXpkYXQgPSBTYW1pemRhdDtcbiJdLCJuYW1lcyI6WyJjYWxsIiwibWV0aG9kIiwicm91dGUiLCJwYXlsb2FkIiwiZmV0Y2giLCJoZWFkZXJzIiwiYm9keSIsIkpTT04iLCJzdHJpbmdpZnkiLCJ1bmRlZmluZWQiLCJjYWxsUmF3IiwiaXNBdXRoZW50aWNhdGVkIiwiYWNjZXNzUmlnaHRzIiwicmVzcG9uc2UiLCJzdGF0dXMiLCJqc29uIiwiZ3JhbnRlZFJpZ2h0cyIsInJpZ2h0IiwiaW5jbHVkZXMiLCJkb0F1dGhlbnRpY2F0aW9uRmxvdyIsInNjcmVlbiIsIndpbmRvdyIsIndpZHRoIiwiaGVpZ2h0IiwicXVlcnkiLCJtYXAiLCJqb2luIiwiYXV0aFdpbmRvdyIsIm9wZW4iLCJFcnJvciIsIlByb21pc2UiLCJyZXNvbHZlciIsImFkZEV2ZW50TGlzdGVuZXIiLCJlIiwiZXZlbnQiLCJjb25zb2xlIiwibG9nIiwiZGV0YWlsIiwiYXV0aGVudGljYXRlIiwiQWNjZXNzUmlnaHQiLCJTdWJzY3JpcHRpb25LaW5kIiwidGhpcyIsImt2c3RvcmUiLCJLVlN0b3JlIiwiX2Vuc3VyZVJpZ2h0cyIsIm5lY2Vzc2FyeVJpZ2h0cyIsImdldE9iamVjdCIsIm9iamVjdCIsImJsb2IiLCJwb3N0T2JqZWN0IiwiY29udGVudCIsIk1hbmFnZU9iamVjdHMiLCJ0ZXh0IiwiZGVsZXRlT2JqZWN0IiwicmVpc3N1ZSIsImJvb2ttYXJrIiwiTWFuYWdlQm9va21hcmtzIiwiaXNCb29rbWFya2VkIiwidW5ib29rbWFyayIsImdldE9iamVjdFN0YXRzIiwiR2V0T2JqZWN0U3RhdHMiLCJnZXRCeXRlVXNlZnVsbmVzcyIsInBvc3RDb2xsZWN0aW9uIiwiaGFzaGVzIiwiaXNEcmFmdCIsIk1hbmFnZUNvbGxlY3Rpb25zIiwiaXNfZHJhZnQiLCJnZXRJdGVtIiwiY29sbGVjdGlvbiIsInBhdGgiLCJwb3N0U2VyaWVzT3duZXIiLCJzZXJpZXNPd25lck5hbWUiLCJrZXlwYWlyIiwiTWFuYWdlU2VyaWVzIiwic2VyaWVzX293bmVyX25hbWUiLCJnZXRTZXJpZXNPd25lciIsInNlcmllc093bmVyIiwiZGVsZXRlU2VyaWVzT3duZXIiLCJnZXRTZXJpZXNPd25lcnMiLCJwb3N0RWRpdGlvbiIsInR0bCIsIm5vQW5ub3VuY2UiLCJub19hbm5vdW5jZSIsImdldFNlcmllc0l0ZW0iLCJzZXJpZXNLZXkiLCJnZXRJZGVudGl0eUl0ZW0iLCJpZGVudGl0eUhhbmRsZSIsInN0YXJ0c1dpdGgiLCJ0b1N0cmluZyIsImdldFN1YnNjcmlwdGlvbiIsIk1hbmFnZVN1YnNjcmlwdGlvbnMiLCJwb3N0U3Vic2NyaXB0aW9uIiwia2luZCIsIkZ1bGxJbnZlbnRvcnkiLCJzZXJpZXNfa2V5IiwiZGVsZXRlU3Vic2NyaXB0aW9uIiwiZ2V0Iiwia2V5IiwicHV0IiwidmFsdWUiLCJkZWxldGUiLCJjbGVhciIsIlNhbWl6ZGF0Il0sInNvdXJjZVJvb3QiOiIifQ==